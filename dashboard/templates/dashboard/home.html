{% extends 'dashboard/base.html' %}
{% block content %}

<h2>Create a Post</h2>
<form method="post">
    {% csrf_token %}
    {{ post_form.as_p }}
    <button type="submit" name="post_submit">Post</button>
</form>

<hr>

<h2>Recent Posts</h2>
{% for post in posts %}
    <div class="post">
        <strong>{{ post.user.username }}</strong> - {{ post.created_at|date:"d M Y H:i" }}<br>
        <p>{{ post.content }}</p>

        <form method="post" action="{% url 'like_post' post.id %}">
            {% csrf_token %}
            <button type="submit">
                üëç {{ post.likes.count }}
            </button>
        </form>

        {% if post.user == user %}
            <form method="post" action="{% url 'delete_post' post.id %}">
                {% csrf_token %}
                <button type="submit">üóë Delete</button>
            </form>
        {% endif %}

        <h4>Comments ({{ post.comments.count }})</h4>
        <ul>
            {% for comment in post.comments.all %}
                <li><b>{{ comment.user.username }}:</b> {{ comment.text }}</li>
            {% endfor %}
        </ul>

        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="post_id" value="{{ post.id }}">
            {{ comment_form.text }}
            <button type="submit" name="comment_submit">Comment</button>
        </form>
    </div>
{% endfor %}

<hr>
<h2>Social Media Feed (API Integration)</h2>
{% for post in mock_posts %}
    <div class="post">
        <strong>{{ post.platform }} - {{ post.username }}</strong><br>
        <p>{{ post.content }}</p>
        <small>{{ post.timestamp }}</small>
    </div>
{% empty %}
    <p>No connected social accounts or no posts fetched.</p>
{% endfor %}

{% endblock %}
